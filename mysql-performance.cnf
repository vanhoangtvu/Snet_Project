# MySQL Performance Configuration for PixShare
# Optimize for 8MB/s BLOB read throughput

[mysqld]

# ========================================
# NETWORK BUFFERS (CRITICAL for 8MB/s)
# ========================================

# Maximum packet size - already set to 1GB (good!)
max_allowed_packet=1073741824

# Network buffer - increase for better throughput
net_buffer_length=8388608  # 8MB (match our chunk size)

# Read buffer - increase for large sequential reads
read_buffer_size=8388608   # 8MB for large BLOB reads
read_rnd_buffer_size=8388608  # 8MB for random reads

# Sort buffer - for ORDER BY operations
sort_buffer_size=8388608   # 8MB

# Join buffer
join_buffer_size=8388608   # 8MB

# ========================================
# INNODB BUFFERS (for BLOB storage)
# ========================================

# InnoDB buffer pool - cache for data and indexes
# Set to 70-80% of available RAM (adjust based on your server)
innodb_buffer_pool_size=2G

# InnoDB log buffer - for write operations
innodb_log_buffer_size=64M

# InnoDB log file size
innodb_log_file_size=256M

# InnoDB flush method - use O_DIRECT for better performance
innodb_flush_method=O_DIRECT

# InnoDB I/O capacity - adjust based on disk speed
# SSD: 2000-5000, HDD: 200-400
innodb_io_capacity=2000
innodb_io_capacity_max=4000

# ========================================
# THREAD & CONNECTION SETTINGS
# ========================================

# Max connections
max_connections=200

# Thread cache
thread_cache_size=50

# ========================================
# QUERY CACHE (Disabled for better performance)
# ========================================

# Query cache disabled in MySQL 8.0+
# Not needed for our use case

# ========================================
# TIMEOUTS
# ========================================

# Wait timeout - 10 minutes for large transfers
wait_timeout=600
interactive_timeout=600

# Net timeouts
net_read_timeout=600
net_write_timeout=600

# ========================================
# BLOB OPTIMIZATION
# ========================================

# Disable binary logging for better write performance (optional)
# skip-log-bin

# Optimize for large packets
slave_max_allowed_packet=1073741824

# ========================================
# MISC PERFORMANCE
# ========================================

# Disable slow query log in production
slow_query_log=0

# Performance schema (can be disabled to save RAM)
performance_schema=OFF

# ========================================
# NOTES
# ========================================
# After changing this file:
# 1. Restart MySQL: docker-compose restart mysql
# 2. Check applied settings: 
#    docker-compose exec mysql mysql -u root -proot_password -e "SHOW VARIABLES LIKE '%buffer%';"
# 
# Bottleneck Analysis:
# - If disk I/O < 100MB/s → upgrade to SSD
# - If RAM < 4GB → increase innodb_buffer_pool_size
# - If network < 1Gbps → check network card

